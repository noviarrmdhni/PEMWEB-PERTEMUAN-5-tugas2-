<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Node JS - MySQL</title>      
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <h1>Daftar User/Pengguna</h1>
    <table border="1">
        <tr>
            <th>ID</th>
            <th>Nama</th>
            <th>Email</th>
            <th>Telepon</th>
            <th>Aksi</th>
        </tr>
        <% users.forEach(Pengguna => {%>
        <tr>
            <td><%= Pengguna.id %></td>
            <td><%= Pengguna.name %></td>
            <td><%= Pengguna.email %></td>
            <td><%= Pengguna.phone %></td>
            <td><a href="/edit/<%= Pengguna.id %>">Edit</a>
                <a href="#" onclick="confirmDeletion(event, '<%= Pengguna.name %>')">Hapus</a>
            </td>
        </tr>
        <% })%>
    </table>

    <h2>Tambah Pengguna Baru</h2>
    <div id="notification" style="color: red; display: none;"></div> 
    <form action="/add" method="post" onsubmit="return validateForm();">
        <label for="name">Nama:</label>
        <input type="text" id="name" name="name" required><br>
        <label for="email">Email:</label>
        <input type="email" name="email" id="email"><br>
        <label for="phone">Telepon:</label>
        <input type="text" name="phone" id="phone"><br>
        <button type="submit">Tambah</button>
    </form>

    <script>
        function validateForm() {
            // bagian notifikasi tambah
            const nama = document.getElementById('name').value.trim(); 
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const notification = document.getElementById('notification');
            
            if (!nama && !email && !phone) {
                notification.innerText = 'Please fill in at least one field to add a new user.';
                notification.style.display = 'block'; 
                return false; 
            }

            let summaryMessage = 'Are you sure you want to add the following user?\n';
            if (nama) summaryMessage += `Name: ${nama}\n`;
            if (email) summaryMessage += `Email: ${email}\n`;
            if (phone) summaryMessage += `Phone: ${phone}\n`;

            const confirmAddition = confirm(summaryMessage);
            if (!confirmAddition) {
                notification.innerText = 'User addition cancelled.';
                notification.style.display = 'block'; 
                return false; 
            }

            notification.style.display = 'none'; 
            return true; 
        }

        // bagian notifikasi hapus
       function confirmDeletion(event, userName) {
    event.preventDefault(); 
    const notification = document.getElementById('notification');

    const confirmDelete = confirm(`Are you sure you want to delete the user: ${userName}?`);
    if (confirmDelete) {
        notification.innerText = `User ${userName} has been deleted.`;
        notification.style.display = 'block'; 
        window.location.href = event.target.href; 
    } else {
        notification.innerText = 'User deletion cancelled.';
        notification.style.display = 'block'; 
    }
}
    </script>
</body>
</html>